<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite
		PUBLIC "-//tuckey.org//DTD UrlRewrite 4.0//EN"
		"http://www.tuckey.org/res/dtds/urlrewrite4.0.dtd">

<!--
	Configuration file for UrlRewriteFilter v4.0.3
	http://www.tuckey.org/urlrewrite/
-->
<urlrewrite>

	<!-- Services have the highest priority -->
	<rule enabled="true">
		<name>Services</name>
		<from>^/(resources|fetch|alerting|export|utils|login|errors|lang|storage|logout|staging-builder|testProduction)(/.*)?$</from>
		<to last="true">/$1$2</to>
	</rule>

	<!-- redirect /page/index to / -->
	<rule enabled="true">
		<name>RedirectIndex</name>
		<from>^/page/index$</from>
		<to last="true" type="redirect">%{context-path}/?%{query-string}</to>
	</rule>

	<!--
		Because we rewrite /page/{pageName} into /{pageName} and because
		/login and /page/login both exists. We rename /page/login into /login-form
		in order to avoid infinite redirection loop

		redirect /page/login to /login-form
	 -->
	<rule enabled="true">
		<name>RedirectLogin</name>
		<from>^/page/login$</from>
		<to last="true" type="redirect">%{context-path}/login-form?%{query-string}</to>
	</rule>

	<!-- redirect /page/pageName to /pageName -->
	<rule enabled="true">
		<name>RedirectPages</name>
		<from>^/page/(\w+)$</from>
		<to last="true" type="redirect">%{context-path}/$1?%{query-string}</to>
	</rule>

	<!-- / -->
	<rule enabled="true">
		<name>Index</name>
		<from>^/$</from>
		<to last="true">/page/index</to>
	</rule>

	<!-- /pageName -->
	<rule enabled="true">
		<name>Pages</name>
		<from>^/(\w+)$</from>
		<to last="true">/page/$1</to>
	</rule>

	<!-- /login-form -->
	<rule enabled="true">
		<name>LoginForm</name>
		<from>^/login\-form$</from>
		<to last="true">/page/login</to>
	</rule>

	<!-- /products/clothes/shirt -->
	<rule enabled="true">
		<name>Search</name>
		<from>^/(\w+)/(\w+)/(\w+)</from>
		<to>/page/search?type=$2&amp;$1=$3</to>
	</rule>
</urlrewrite>
