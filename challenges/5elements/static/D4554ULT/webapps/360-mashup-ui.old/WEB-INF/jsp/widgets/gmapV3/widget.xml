<?xml version="1.0" encoding='UTF-8'?>
<Widget name="Google Maps" group="Visualizations/Maps">

	<Description>Shows your results as pins on a Google Map, with automatic centering and zoom levels for your result set.</Description>

	<Preview>
	<![CDATA[
		<img src="/resources/widgets/gmapV3/images/gmap.gif" />
	]]>
	</Preview>

	<Platforms>
		<Platform type="web" supported="true" />
		<Platform type="mobile" supported="true" />
	</Platforms>

	<Includes>
		<Include type="js" path="/resources/javascript/exa/geo/geo.js" />
		<Include type="js" path="/resources/javascript/exa/io/io.js" />
		<Include type="js" path="/resources/javascript/exa/io/GeoInterface.js" />
		<Include type="js" path="/resources/javascript/exa/io/HitSelectionInterface.js" />
		<Include type="js" path="/resources/javascript/exa/io/HitDecorationInterface.js" />
		<Include type="js" path="/resources/javascript/exa/util/Context.js" />
		<Include type="js" path="/resources/javascript/exa/util/Queue.js" />
		<Include type="js" path="/resources/javascript/exa/util/KVOObject.js" />
		<Include type="js" path="js/GeoInterfaceImpl.js" />
		<Include type="js" path="js/GoogleMarker.js" />
		<Include type="js" path="js/GoogleMarkerManager.js" />
		<Include type="js" path="js/GoogleFormManager.js" />
		<Include type="js" path="js/GoogleMapWidget.js" />
		<Include type="css" path="css/style.less" />
	</Includes>

	<SupportWidgetsId arity="ZERO" />
	<SupportFeedsId arity="ZERO_OR_MANY" />
	<SupportI18N supported="true" />
		
	<Interactions>
		<Interaction type="out" id="exa.io.GeoInterface"></Interaction>
		<Interaction type="out" id="exa.io.HitDecorationInterface"></Interaction>
		<Interaction type="out" id="exa.io.HitSelectionInterface"></Interaction>
	</Interactions>
	
	<OptionsGroup name="General">
		<Description>CAUTION: You must pay attention to license issues when using cartographic services! You can use the premium versions by defining your API key in the widget configuration. If no key is specified, you will use the light versions of these services.</Description>
		<Option id="title" name="Widget Title" isEvaluated="true">
			<Description>Widget title. If blank, no name is displayed.</Description>
		</Option>
		<Option id="defaultZoom" name="Default zoom level" arity="ZERO_OR_ONE">
			<Description>Default zoom level used if there is only one pin in the map, min:0 (distant) max:22 (near)</Description>
		</Option>
		<Option id="mapTypeId" name="Map Type">
			<Description>Specifies the map type that must be displayed by the widget. </Description>		
			<Values>
				<Value>ROADMAP</Value>
				<Value>SATELLITE</Value>
				<Value>HYBRID</Value>
				<Value>TERRAIN</Value>
			</Values>
		</Option>
		<Option id="mapTypeControl" name="Enable map type control">
			<Description>The initial enabled/disabled state of the Map type control.</Description>
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
		</Option>
		<Option id="streetViewControl" name="Enable street view control">
			<Description>The initial enabled/disabled state of the Street View Pegman control.</Description>
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
		</Option>
		<Option id="geoFormEdition" name="Enable geo form edition">
			<Description>If enabled, you will be able to draw polygons or circles on the map.</Description>
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
		</Option>
		<Option id="keyType" name="Type of Google Maps key" arity="ONE" isEvaluated="false" isUrlEncoded="false" isXmlEscaped="false">
			<Description>Select the type of the key you want to use. "free" has a high restrictive map/geocoding requests limit.</Description>
			<Values>
				<Value>free</Value>
				<Value>clientid</Value>
				<Value>key</Value>
			</Values>
			<Functions>
				<Display>ToggleDisplay({ valueToMatch: 'free', hideOptions: ['clientId']})</Display>
			</Functions>
		</Option>
		<Option id="clientId" name="Google maps id/key" arity="ONE">
			<Description>Cannot be empty. Type a key or client id following your needs.</Description>
		</Option>
	</OptionsGroup>

	<OptionsGroup name="Based on Entries">
		<Description>Options marked with (1) or (2) are required to have entries support.</Description>
		<Option id="addr" name="Address (1)" isEvaluated="true">
			<Description>
				<![CDATA[
					MEL expression used for the hit address.<br />
					If coordinates are also provided with the <i>Location option</i>, they will have a higher priority than the address.<br />
					Note: This functionality is slow because we have to get the coordinates of each addresses.
				]]>
			</Description>
		</Option>
		<Option id="location" name="Location (2)" isEvaluated="true">
			<Description>
			<![CDATA[
					MEL expression used for the hit position with expected format : <i>latitude,longitude</i>
					<ul>
						<li>Location : ${entry.metas["meta_of_type_gps_point"]}</li>
						<li>Latitude + Longitude : ${entry.metas["meta_latitude"]},${entry.metas["meta_longitude"]}</li>
					</ul>
				]]></Description>
		</Option>
		<Option id="hitUrl" name="Hit URL" isUrlEncoded="true" isEvaluated="true">
			<Description>Specifies the link to create for each icon. An invalid page name will not create a link.</Description>
			<Functions>
				<ContextMenu>Pages()</ContextMenu>
			</Functions>
		</Option>
		<Option id="iconUrl" name="Image URL Marker" isEvaluated="true">
			<Description>
				<![CDATA[
					If blank, icon url will be:<br />
					http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%{indexMarker}|3279BE|FFF<br />
					%{indexMarker} is a magic variable which will be replaced by an incremental number
				]]>
			</Description>
			<Functions>
				<ContextMenu>COMMON_add('Javascript', ['%{indexMarker}'])</ContextMenu>
			</Functions>
		</Option>
		<Option id="messagePopup" name="Message popup" isXmlEscaped="true" isEvaluated="true">
			<Description>
				<![CDATA[
					Defines the message that will be displayed in the bubble of the pin selection.<br />
					This message can contain HTML code.<br />
					If you need some logic, try the 'popup template path' option below this option.
				]]>
			</Description>
		</Option>
		<Option id="popupTemplatePath" name="Popup template path" isEvaluated="true">
			<Description>
				<![CDATA[<p>JSP template shown in the popup.<br />
				You can use JSTL functions to add logics in it.<br />
				An example can be found at:<br />
				<span style="white-space:nowrap;">/WEB-INF/jsp/widgets/gmapV3/messagePopup/example_entries.jsp</span></p>
				]]>
			</Description>
			<Functions>
				<ContextMenu>Pages()</ContextMenu>
				<Check>isJspPath</Check>
			</Functions>
		</Option>
	</OptionsGroup>

	<OptionsGroup name="Based on Facets">
		<Description>Options marked with (1) and one of (2) or (3) are required to have Facets support.</Description>
		<Option id="facet_hitFacetPageName" name="Destination page on click" isUrlEncoded="true" isEvaluated="true">
			<Description>Indicates the URL that must be accessed for a refinement option. If blank, you stay on the same page.</Description>
			<Functions>
				<ContextMenu>Pages()</ContextMenu>
			</Functions>
		</Option>
		<Option id="facetsList" name="Facets list (1)">
			<Description>The specified facets, separated by commas.</Description>
			<Functions>
				<ContextMenu>Facets()</ContextMenu>
			</Functions>
		</Option>
		<Option id="facet_addr" name="Address (2)" isEvaluated="true">
			<Description>
				<![CDATA[
					MEL expression used for the category address.<br />
					If coordinates are also provided with the <i>Location option</i>, they will have a higher priority than the address.<br />
					Note: This functionality is slow because we have to get the coordinates of each addresses.
				]]>
			</Description>
		</Option>
		<Option id="facet_location" name="Location(3)" isEvaluated="true">
			<Description>
			<![CDATA[
					MEL expression used for the category position with expected format : <i>latitude,longitude</i>
					<ul>
						<li>Location : ${category.description}</li>
					</ul>
			]]></Description>
		</Option>
		<Option id="facet_nbSubFacets" name="Number of categories displayed">
			<Description>Specifies the maximum number of categories to display. You must enter an integer.</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
		<Option id="facet_iterMode" name="Iteration mode" arity="ONE">
			<Description>
				<![CDATA[
					Determines what data is displayed:
					<ul>
						<li>'all' visits the first child of each node before processing its siblings,</li>
						<li>'leaves' iterates recursively, returning the end nodes,</li>
						<li>'flat' returns only the first level.</li>
					</ul>
				]]>
			</Description>
			<Values>
				<Value>flat</Value>
				<Value>leaves</Value>
				<Value>all</Value>
			</Values>
		</Option>
		<Option id="facet_iconUrl" name="Image URL Marker" isEvaluated="true">
			<Description>
				<![CDATA[
					If blank, icon url will be:<br />
					http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%{indexMarker}|3279BE|FFF<br />
					%{indexMarker} is a magic variable which will be replaced by an incremental number. 
				]]>
			</Description>
			<Functions>
				<ContextMenu>COMMON_add('Javascript', ['%{indexMarker}'])</ContextMenu>
				<ContextMenu>WIDGET_EvalCategory()</ContextMenu>
				<ContextMenu>WIDGET_EvalFacet()</ContextMenu>
			</Functions>
		</Option>
		<Option id="facet_messagePopup" name="Message popup" isXmlEscaped="true" isEvaluated="true">
			<Description>
				<![CDATA[
					Defines the message that will be displayed in the bubble of the pin selection.<br />
					This message can contain HTML code.<br />
					If you need some logic, try the 'popup template path' option below this option.<br />
					Aggregation: This field is evaluated so you can use MEL ( ${category.aggrs["your_aggregation"]} ) to get aggregation value in your popup
				]]>
			</Description>
		</Option>
		<Option id="facet_popupTemplatePath" name="Popup template path" isEvaluated="true">
			<Description>
				<![CDATA[
					JSP template shown in the popup. You can use JSTL functions to add logics in it. An example can be found at:<br />
					<span style="white-space:nowrap;">/WEB-INF/jsp/widgets/gmapV3/messagePopup/example_facets.jsp</span>
				]]>
			</Description>
			<Functions>
				<ContextMenu>Pages()</ContextMenu>
				<Check>isJspPath</Check>
			</Functions>
		</Option>
		
		<Option id="forceRefineOnFeeds" name="Force refinement for feeds" arity="ZERO_OR_MANY">
			<Description>Forces refinements on the specified feeds.</Description>
			<Functions>
				<ContextMenu>Feeds()</ContextMenu>
				<ContextMenu>COMMON_emptyOnChange()</ContextMenu>
			</Functions>
		</Option>
	</OptionsGroup>
	
	<OptionsGroup name="Based on Geo Facets">
		<Option id="geoFacetsList" name="Geo facets list">
			<Description>The specified geo facets, separated by commas.</Description>
			<Functions>
				<ContextMenu>GeoFacets()</ContextMenu>
				<ContextMenu>COMMON_appendOnChange(', ')</ContextMenu>
			</Functions>
		</Option>
		<Option id="geofacet_hitFacetPageName" name="Destination page on click" isUrlEncoded="true" isEvaluated="true">
			<Description>Indicates the URL that must be accessed for a refinement option. If blank, you stay on the same page.</Description>
			<Functions>
				<ContextMenu>Pages()</ContextMenu>
			</Functions>
		</Option>
		<Option id="geofacet_forceRefineOnFeeds" name="Force refinement for feeds" arity="ZERO_OR_MANY">
			<Description>Forces refinements on the specified feeds.</Description>
			<Functions>
				<ContextMenu>Feeds()</ContextMenu>
				<ContextMenu>COMMON_emptyOnChange()</ContextMenu>
			</Functions>
		</Option>		
		<Option id="geofacet_aggregation" name="Aggregation" arity="ZERO_OR_ONE" isEvaluated="true">
			<Description>Aggregation used to colorize shape</Description>
			<Functions>
				<ContextMenu>Aggregations('geoFacetsList')</ContextMenu>
				<ContextMenu>COMMON_emptyOnChange()</ContextMenu>
			</Functions>
		</Option>
		<Option id="geofacet_tooltip" name="Tooltip" arity="ZERO_OR_ONE">
			<Description>MEL expression used for tooltip.</Description>
			<Functions>
				<ContextMenu>WIDGET_EvalCategory()</ContextMenu>
				<ContextMenu>WIDGET_EvalFacet()</ContextMenu>
			</Functions>
		</Option>
		<Option id="geofacet_useHeatmap" name="HeatMap" arity="ONE">
			<Description>Displays a heatMap instead shapes. (Only used for autotiles geo facets)</Description>
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
		</Option>
	</OptionsGroup>

	<OptionsGroup name="Ajax">
		<Description>
			<![CDATA[
				On map move, <b>Lattitude parameter's name</b> & <b>Longitude parameter's name</b> parameters are append to the query string
			]]>
		</Description>
		<Option id="ajaxWUIDs" name="Update Widgets" arity="ZERO_OR_MANY">
			<Description>On map move, refresh the list of given widgets identified by a unique ID called WUID.</Description>
			<Functions>
				<ContextMenu>WIDGET_getWUIDS()</ContextMenu>
				<ContextMenu>COMMON_emptyOnChange()</ContextMenu>
			</Functions>
		</Option>
		<Option id="ajaxParameterNameLat" name="Latitude parameter's name">
			<Description>Specifies the parameter name that will be used for latitude in queries. For example 'lat'.</Description>		
			<Functions>
				<ContextMenu>PageParameters()</ContextMenu>
				<ContextMenu>COMMON_emptyOnChange()</ContextMenu>
			</Functions>
		</Option>
		<Option id="ajaxParameterNameLng" name="Longitude parameter's name">
			<Description>Specifies the parameter name that will be used for longitude in queries. For example 'lng'.</Description>				
			<Functions>
				<ContextMenu>PageParameters()</ContextMenu>
				<ContextMenu>COMMON_emptyOnChange()</ContextMenu>
			</Functions>
		</Option>
		<Option id="ajaxParameterNameZoomLevel" name="Zoom level parameter's name">
			<Description>Specifies the parameter name that will be used for zoom level in queries. For example 'zoomlevel'.</Description>			
			<Functions>
				<ContextMenu>PageParameters()</ContextMenu>
				<ContextMenu>COMMON_emptyOnChange()</ContextMenu>
			</Functions>
		</Option>
	</OptionsGroup>

	<OptionsGroup name="Markers">
		<Option id="gmarkerBGColor" name="Google pin background color">
			<Description>Defines the default Google pin background color. If blank, the Google default is used.</Description>
		</Option>
		<Option id="gmarkerFGColor" name="Google pin foreground color">
			<Description>Defines the default Google pin foreground color. If blank, the Google default is used.</Description>
		</Option>
		<Option id="iconAnchorX" name="Icon AnchorX">
			<Description>Specifies the pixel relative to the top left corner of the icon image to which this icon is anchored in the map.</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
		<Option id="iconAnchorY" name="Icon AnchorY">
			<Description>Specifies the pixel relative to the top left corner of the icon image to which this icon is anchored in the map.</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
		<Option id="popUpAnchorX" name="Popup AnchorX">
			<Description>Specifies the pixel relative to the top left corner of the popup to which this icon is anchored in the map.</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
		<Option id="popUpAnchorY" name="Popup AnchorY">
			<Description>Specifies the pixel relative to the top left corner of the popup to which this icon is anchored in the map.</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
		<Option id="sizeHeight" name="Height">
			<Description>Specifies the height of the foreground image of the icon (pixels).</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
		<Option id="sizeWidth" name="Width">
			<Description>Specifies the width of the foreground image of the icon (pixels).</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
	</OptionsGroup>

	<OptionsGroup name="Style">
		<Option id="width" name="Width">
			<Description>Specifies the width of the Google Map widget (pixels).</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
		<Option id="height" name="Height" arity="ONE">
		  <Description>Specifies the height of the Google Map widget (pixels).</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
	</OptionsGroup>

	<DefaultValues>
		<DefaultValue name="defaultZoom">11</DefaultValue>
		<DefaultValue name="mapTypeId">ROADMAP</DefaultValue>
		<DefaultValue name="mapTypeControl">false</DefaultValue>
		<DefaultValue name="streetViewControl">false</DefaultValue>
		<DefaultValue name="geoFormEdition">false</DefaultValue>
		
		<DefaultValue name="facet_iterMode">flat</DefaultValue>
		

		<DefaultValue name="ajaxParameterNameLat">lat</DefaultValue>
		<DefaultValue name="ajaxParameterNameLng">lng</DefaultValue>
		<DefaultValue name="ajaxParameterNameZoomLevel">zoomlevel</DefaultValue>

		<DefaultValue name="gmarkerBGColor">#ED6813</DefaultValue>
		<DefaultValue name="gmarkerFGColor">#FFFFFF</DefaultValue>
		<DefaultValue name="iconAnchorX">10</DefaultValue>
		<DefaultValue name="iconAnchorY">31</DefaultValue>
		<DefaultValue name="popUpAnchorX">0</DefaultValue>
		<DefaultValue name="popUpAnchorY">0</DefaultValue>
		<DefaultValue name="sizeHeight">31</DefaultValue>
		<DefaultValue name="sizeWidth">21</DefaultValue>
		<DefaultValue name="height">350</DefaultValue>
	</DefaultValues>
</Widget>
