<?xml version="1.0" encoding='UTF-8'?>
<Widget name="Export to CSV/Atom/PDF" group="Miscellaneous" premium="true">

	<Description>Provides links to download the current results into different formats (Excel CSV, Atom, PDF).</Description>

	<Preview>
		<![CDATA[
			<img src="/resources/widgets/exportWidget/images/preview.png" />
		]]>
	</Preview>

	<Includes>
		<Include type="css" path="css/style.less" />
	</Includes>

	<SupportWidgetsId arity="ZERO" />
	<SupportFeedsId arity="ONE" />
	<SupportI18N supported="true" />

	<OptionsGroup name="General">
		<Option id="title" name="Widget Title" isEvaluated="true">
			<Description>Widget title. If blank, no name is displayed.</Description>
		</Option>
	</OptionsGroup>

	<OptionsGroup name="Atom export">
		<Option id="atomExport" name="Enable ATOM export">
			<Description>Adds an RSS button on the page to download the current search results into Atom format.</Description>		
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
		</Option>
		<Option id="atomMethod" name="Request method">
			<Description>Specifies whether to use GET or POST to retreive ATOM export.</Description>
			<Values>
				<Value>GET</Value>
				<Value>POST</Value>
			</Values>
		</Option>
	</OptionsGroup>

	<OptionsGroup name="CSV export">
		<Option id="csvExport" name="Enable CSV export">
			<Description>Adds an MS Excel button on the page to download the current search results into CSV format.</Description>
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
			<Functions>
				<Display>ToggleDisplay({ valueToMatch: 'true', showOptions: ['isRamBased', 'metas', 'fileName', 'encoding', 'separator', 'bom', 'separatorMultiValued', 'exportAllPages', 'maximumExportedPages'] })</Display>
			</Functions>
		</Option>
		<Option id="isRamBased" name="Export all metas">
			<Description>Specifies whether to export all the metas displayed in the search results into the CSV output. If 'false', you can select the metas to display using the 'Meta list' property.</Description>
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
			<Functions>
				<Display>ToggleReadOnly({ valueToMatch: 'false', options: ['metas'] })</Display>
			</Functions>
		</Option>
		<Option id="metas" name="Meta list">
			<Description>The specified metas, separated by commas, will be the only ones displayed.</Description>
			<Functions>
				<ContextMenu>WIDGET_getCurrentFeedMetas('', ', ', false)</ContextMenu>
				<ContextMenu>COMMON_appendOnChange(', ')</ContextMenu>
			</Functions>
		</Option>
		<Option id="fileName" name="File name" arity="ONE" isEvaluated="true">
			<Description>Specifies the CSV file name.</Description>
		</Option>
		<Option id="encoding" name="Encoding">
			<Description>Specifies the encoding format to use in the CSV output.</Description>
			<Values>
				<Value>UTF-8</Value>
				<Value>ISO-8859-15</Value>
			</Values>
			<Functions>
				<Display>ToggleReadOnly({ valueToMatch: 'UTF-8', options: ['bom'] })</Display>
			</Functions>
		</Option>
		<Option id="bom" name="Byte Order Mark" arity="ZERO_OR_ONE">
			<Description>Specifies, for UTF-8 encoding, whether to appends or not a Byte Order Mark at the beginning of the file.</Description>
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
		</Option>
		<Option id="separator" name="Separator" arity="ONE">
			<Description>Specifies the separator to use in the CSV output. By default, the CSV file is saved with semicolon separators.</Description>			
		</Option>
		<Option id="separatorMultiValued" name="Multi-valued separator" arity="ZERO_OR_ONE">
			<Description>Specifies the separator to use in the CSV output for multi-valued metas. By default ','.</Description>
		</Option>
		<Option id="exportAllPages" name="Export all results">
			<Description>Specifies how to export the results displayed in the search results into the CSV output. If 'false', only the first page is exported. If 'true', everything is exported within a certain limit (you must define the number of pages to export).</Description>			
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
			<Functions>
				<Display>ToggleReadOnly({ valueToMatch: 'false', options: ['maximumExportedPages'] })</Display>
			</Functions>
		</Option>
		<Option id="maximumExportedPages" name="Maximum number of pages" arity="ONE">
			<Description>Specifies the maximum number of pages that will be exported.</Description>
			<Functions>
				<Check>isInteger</Check>
			</Functions>
		</Option>
		<Option id="csvMethod" name="Request method">
			<Description>Specifies whether to use GET or POST to retreive CSV export.</Description>
			<Values>
				<Value>GET</Value>
				<Value>POST</Value>
			</Values>
		</Option>
	</OptionsGroup>

	<OptionsGroup name="PDF export">
		<Option id="pdfExport" name="Enable PDF export">
			<Description>Adds an Adobe PDF button on the page to download the current search results into PDF format.</Description>			
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
			<Functions>
				<Display>PARAMETER_doHide('true', [], ['customExportURL', 'pdfFileName'], true, false)</Display>
			</Functions>
		</Option>
		<Option id="customExportURL" name="URL to export" isEvaluated="true">
			<Description>By default (if it's empty), the current page will be exported. Otherwise you can specify another page with an optional query string.</Description>
			<Functions>
				<ContextMenu>Pages()</ContextMenu>
			</Functions>
		</Option>
		<Option id="pdfFileName" name="File name" arity="ONE">
			<Description>Specifies the PDF file name.</Description>			
		</Option>
	</OptionsGroup>
	
	<OptionsGroup name="PNG export">
		<Option id="pngExport" name="Enable PNG export">
			<Description>Adds a PNG button on the page to download the current search results into PNG format.</Description>			
			<Values>
				<Value>false</Value>
				<Value>true</Value>
			</Values>
			<Functions>
				<Display>ToggleDisplay({valueToMatch:'false', hideOptions:['pngCustomExportURL', 'pngFileName', 'pngWidth', 'pngHeight']})</Display>
			</Functions>
		</Option>
		<Option id="pngCustomExportURL" name="URL to export" isEvaluated="true">
			<Description>By default (if it's empty), the current page will be exported. Otherwise you can specify another page with an optional query string.</Description>
			<Functions>
				<ContextMenu>Pages()</ContextMenu>
			</Functions>
		</Option>
		<Option id="pngFileName" name="File name" arity="ONE">
			<Description>Specifies the PNG file name.</Description>
		</Option>
		<Option id="pngWidth" name="Width" arity="ZERO_OR_ONE" isEvaluated="true">
			<Description>Specifies the PNG width in px. Defaults to 800</Description>
		</Option>
		<Option id="pngHeight" name="Height" arity="ZERO_OR_ONE" isEvaluated="true">
			<Description>Specifies the PNG height in px. Defaults to 600.</Description>
		</Option>
	</OptionsGroup>
	
	<DefaultValues>
		<DefaultValue name="atomExport">true</DefaultValue>
		<DefaultValue name="csvExport">true</DefaultValue>
		<DefaultValue name="fileName">csv_${feed.id}_${feed.query}.csv</DefaultValue>
		<DefaultValue name="encoding">UTF-8</DefaultValue>
		<DefaultValue name="separator">;</DefaultValue>
		<DefaultValue name="separatorMultiValued">,</DefaultValue>
		<DefaultValue name="exportAllPages">false</DefaultValue>
		<DefaultValue name="maximumExportedPages">50</DefaultValue>
		<DefaultValue name="method">GET</DefaultValue>
		<DefaultValue name="pdfExport">true</DefaultValue>
		<DefaultValue name="pdfFileName">export.pdf</DefaultValue>
		<DefaultValue name="pngExport">false</DefaultValue>
		<DefaultValue name="pngFileName">export.png</DefaultValue>
	</DefaultValues>
</Widget>
